#!/usr/bin/env Rscript
args = commandArgs(trailingOnly=TRUE)
options(error=traceback)

# Loading libraries
library(plyr)
library(ggplot2)

# Reading input arguments
usage = "This script should be called this way:
Rscript --vanilla compare_outputs.R AGGREGATED OUTPUT_DIR
    AGGREGATED: the aggregated metrics CSV output
    OUTPUT_DIR: the directory in which the figures generated by this script are outputted"

if (length(args)!=2)
    stop(usage, call.=FALSE)

if (!dir.exists(args[2]))
    stop("Invalid OUTPUT_DIR parameter: directory does not exist", call.=FALSE)

aggregated = read.csv(args[1])
output_dir = args[2]

# Setting working directory to OUTPUT_DIR
setwd(output_dir)

# Generate graphs
ggplot(aggregated, aes(x = makespan, y = makespan)) +
    geom_point(aes(shape = workload_type)) + scale_shape_manual(values=c(1,3)) +
    xlab("Makespan (s)") + ylab("Makespan (s)") + theme(legend.title=element_blank())
ggsave("aggregated_comparison_makespan.pdf")

ggplot(aggregated, aes(x = makespan, y = mean_stretch)) +
    geom_point(aes(shape = workload_type)) + scale_shape_manual(values=c(1,3)) +
    xlab("Makespan (s)") + ylab("Mean stretch") + theme(legend.title=element_blank())
ggsave("aggregated_comparison_mean_stretch.pdf")

ggplot(aggregated, aes(x = makespan, y = mean_bounded_stretch)) +
    geom_point(aes(shape = workload_type)) + scale_shape_manual(values=c(1,3)) +
    xlab("Makespan (s)") + ylab("Mean bounded stretch") + theme(legend.title=element_blank())
ggsave("aggregated_comparison_mean_bounded_stretch.pdf")

ggplot(aggregated, aes(x = makespan, y = mean_waiting_time)) +
    geom_point(aes(shape = workload_type)) + scale_shape_manual(values=c(1,3)) +
    xlab("Makespan (s)") + ylab("Mean waiting time (s)") + theme(legend.title=element_blank())
ggsave("aggregated_comparison_mean_waiting_time.pdf")

ggplot(aggregated, aes(x = makespan, y = mean_turnaround_time)) +
    geom_point(aes(shape = workload_type)) + scale_shape_manual(values=c(1,3)) +
    xlab("Makespan (s)") + ylab("Mean turnaround time (s)") + theme(legend.title=element_blank())
ggsave("aggregated_comparison_mean_turnaround_time.pdf")
